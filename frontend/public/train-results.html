<!DOCTYPE html>
<html dir="rtl" lang="fa">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>نتایج جستجوی قطار | هتل مارکوپولو</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700&display=swap"
          rel="stylesheet">
    <link href="style.css" rel="stylesheet">
</head>
<body>
<!-- Header -->
<header>
    <div class="container nav-container">
        <a class="logo" href="index.html">
            <i class="fas fa-train"></i>
            هتل مارکوپولو
        </a>

        <ul class="nav-menu">
            <li><a href="index.html"><i class="fas fa-bed"></i> هتل</a></li>
            <li><a href="flight.html"><i class="fas fa-plane"></i> پرواز</a></li>
            <li><a class="active" href="train.html"><i class="fas fa-train"></i> قطار</a></li>
            <li><a href="bus.html"><i class="fas fa-bus"></i> اتوبوس</a></li>
            <li><a href="tour.html"><i class="fas fa-umbrella-beach"></i> تور</a></li>
        </ul>

        <div class="auth-buttons">
            <button class="btn btn-outline" onclick="window.location.href='login.html'">
                <i class="fas fa-sign-in-alt"></i> ورود
            </button>
            <button class="btn btn-primary" onclick="window.location.href='register.html'">
                <i class="fas fa-user-plus"></i> ثبت‌نام
            </button>
        </div>
    </div>
</header>

<main style="background:#f5f7fa; min-height:80vh; padding:5rem 0 3rem;">
    <div class="container">
        <div class="section-title">
            <h2>نتایج جستجوی قطار</h2>
            <p id="search-summary">در حال بارگذاری نتایج...</p>
        </div>

        <section class="popular-routes">
            <div id="loading" style="text-align: center; padding: 3rem;">
                <i class="fas fa-spinner fa-spin fa-3x" style="color: var(--primary);"></i>
                <p style="margin-top: 1rem;">در حال جستجوی قطارها...</p>
            </div>
            <div id="no-results" style="display:none; text-align:center; padding:3rem;">
                <i class="fas fa-search fa-3x" style="color:#ccc; margin-bottom:1rem;"></i>
                <h3>قطاری یافت نشد</h3>
                <p>لطفاً مبدأ، مقصد یا تاریخ را تغییر دهید و دوباره تلاش کنید.</p>
                <button class="btn btn-primary" onclick="window.location.href='train.html'" style="margin-top:1rem;">
                    بازگشت به جستجوی قطار
                </button>
            </div>
            <div class="routes-grid" id="trains-grid" style="display:none;"></div>
        </section>
    </div>
</main>

<!-- Footer (همانند train.html) -->
<footer>
    <div class="container">
        <div class="footer-grid">
            <div class="footer-col">
                <h3>بخش قطار</h3>
                <p>رزرو آنلاین بلیط تمامی قطارهای داخلی و بین‌المللی با بهترین خدمات و امکانات.</p>
                <div class="social-links">
                    <a href="#"><i class="fab fa-instagram"></i></a>
                    <a href="#"><i class="fab fa-telegram"></i></a>
                    <a href="#"><i class="fab fa-twitter"></i></a>
                    <a href="#"><i class="fab fa-linkedin"></i></a>
                </div>
            </div>

            <div class="footer-col">
                <h3>لینک‌های مفید</h3>
                <ul>
                    <li><a href="#">درباره ما</a></li>
                    <li><a href="#">تماس با ما</a></li>
                    <li><a href="#">قوانین رزرو قطار</a></li>
                    <li><a href="#">سوالات متداول</a></li>
                    <li><a href="#">وبلاگ سفر</a></li>
                </ul>
            </div>

            <div class="footer-col">
                <h3>خدمات قطار</h3>
                <ul>
                    <li><a href="#">قطارهای داخلی</a></li>
                    <li><a href="#">قطارهای بین‌المللی</a></li>
                    <li><a href="#">قطارهای توریستی</a></li>
                    <li><a href="#">قطارهای لوکس</a></li>
                    <li><a href="#">رزرو کوپه خواب</a></li>
                </ul>
            </div>

            <div class="footer-col">
                <h3>تماس با ما</h3>
                <ul>
                    <li><i class="fas fa-phone"></i> ۰۲۱-۹۱۰۱۱۱۱۱</li>
                    <li><i class="fas fa-envelope"></i> train@hotelplus.ir</li>
                    <li><i class="fas fa-map-marker-alt"></i> تهران، خیابان ولیعصر</li>
                </ul>
            </div>
        </div>

        <div class="copyright">
            <p>© ۲۰۲۴ تمامی حقوق برای هتل‌مارکوپولو محفوظ است.</p>
        </div>
    </div>
</footer>

<script src="config.js"></script>
<script>
    const api = (path) => `${window.BACKEND_BASE_URL || 'http://localhost:8080'}${path}`;

    function buildTrainSummary(params) {
        const origin = params.get('origin');
        const destination = params.get('destination');
        const date = params.get('date');
        const trainClass = params.get('trainClass');
        const parts = [];
        if (origin && destination) parts.push(`از ${origin} به ${destination}`);
        else if (origin) parts.push(`از ${origin}`);
        else if (destination) parts.push(`به ${destination}`);
        if (date) parts.push(`تاریخ حرکت: ${date}`);
        if (trainClass) parts.push(`کلاس: ${trainClass}`);
        return parts.length ? parts.join(' | ') : 'همه قطارهای موجود';
    }

    async function loadTrains() {
        const params = new URLSearchParams(window.location.search);
        document.getElementById('search-summary').textContent = buildTrainSummary(params);

        const loading = document.getElementById('loading');
        const noResults = document.getElementById('no-results');
        const grid = document.getElementById('trains-grid');

        try {
            const qs = new URLSearchParams();
            ['origin', 'destination', 'date', 'trainClass'].forEach(key => {
                const v = params.get(key);
                if (v) qs.append(key, v);
            });

            const res = await fetch(api(`/api/trains/search?${qs.toString()}`));
            if (!res.ok) throw new Error();

            const trains = await res.json();
            loading.style.display = 'none';

            if (!trains || trains.length === 0) {
                noResults.style.display = 'block';
                return;
            }

            grid.style.display = 'grid';
            grid.innerHTML = '';

            trains.forEach(train => {
                const card = document.createElement('div');
                card.className = 'route-card';
                card.style.cursor = 'pointer';
                card.onclick = () => window.location.href = `train-details.html?id=${train.id}`;

                const priceText = train.price ? train.price.toLocaleString('fa-IR') + ' تومان' : 'قیمت نامشخص';

                card.innerHTML = `
                    <h3>${train.origin} - ${train.destination}</h3>
                    <div class="route-details">
                        <div>
                            <div>${train.origin}</div>
                            <small>${train.departureTime || '—'}</small>
                        </div>
                        <div class="time-badge">${train.trainClass || ''}</div>
                        <div>
                            <div>${train.destination}</div>
                            <small>${train.arrivalTime || '—'}</small>
                        </div>
                    </div>
                    <div class="route-stops">
                        <i class="fas fa-map-marker-alt"></i>
                        <span>${train.stops || 'بدون توقف'}</span>
                    </div>
                    <div class="train-features">
                        <span>صندلی‌های خالی: ${train.availableSeats != null ? train.availableSeats : 'نامشخص'}</span>
                        <span>${train.trainName || ''}</span>
                    </div>
                    <div class="route-price">از ${priceText}</div>
                `;

                grid.appendChild(card);
            });
        } catch (e) {
            console.error('Error loading trains', e);
            loading.style.display = 'none';
            noResults.style.display = 'block';
        }
    }

    document.addEventListener('DOMContentLoaded', loadTrains);
</script>
</body>
</html>


